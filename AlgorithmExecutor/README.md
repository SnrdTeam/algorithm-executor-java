# Исполнитель для Java

Консольное приложение Java для исполнения алгоритмов, реализованное в соответствии со спецификацией *Исполнителя*.
Поддерживаются следующие *Среды исполнения*:

  * jre6-jar
  * jre7-jar
  * jre8-jar

Числа 6, 7, 8 здесь указывают на минимально используемую версию Java Runtime Environment.
  
## Структура файлов в *Определении алгоритма*

Папка, содержащая реализацию *Алгоритма* на Java в *Определении алгоритма* (в соответствии со спецификацией *Определения алгоритма* путь к данной папке "/runtimes/jreX-jar", где X - номер версии Java Runtime Environment: 6, 7 или 8) имеет следующую структуру:

  * libs
    * Library1.jar
    * Library2.jar
    * LibraryN.jar
    * AlgorithmImplementation.jar
  * entrypoint
  
В папке **libs** располагаются java-библиотеки в формате jar, которые будут загружены при запуске *Алгоритма*. В данной папке может находится один или более jar-файл.
  
**entrypoint** - это текстовый файл в кодировке UTF-8, содержащий одну строку - полное имя статического метода, который является точкой входа.
Полное имя метода - это <имя пакета>.<имя класса>.<имя метода>. Например,`com.adeptik.AlgorithmImpl.run` указывает на статический метод "run" класса "AlgorithmImpl", который располагается в пакете "com.adeptik". 

Данный метод будет вызван при запуске *Алгоритма*.
Данный метод обязан принимать единственный параметр типа `com.adeptik.algorithm.runtime.Context` (объявлен в [AlgorithmRuntime](../AlgorithmRuntime/README.md)).

## Установка

Для установки *Исполнителя* для Java необходимо:

  1. Получить дистрибутив *Исполнителя* для Java.
  2. Настроить *Агент* для Java.
  
### Получение дистрибутива

Дистрибутив представляет собой zip-архив. Получить дистрибутива можно одним из следующих способов:

  * Выполнить команду
   
        gradle distZip
        
    В папку, build/distributions помещается zip-архив, который является дистрибутивом *Исполнителя* для Java.    
    
### Настройка Агента для Java под Windows

Полученный дистрибутив *Исполнителя* для Java необходимо распаковать в любую папку на компьютере, где установлен *Агент* для Java.
В файле настроек *Агента* для Java необходимо добавить

```json
{
  "executors": [
    {
      "command": ["java.exe", "-jar", "<путь к исполнителю>"]
    }
    
    // другие исполнители
  ]
  
  // другие настройки агента
}
```

<java.exe> - исполняемый файл Java Runtime Environment (JRE). В системной переменной `PATH` должен быть указан путь к папке `bin` установленной JRE версии 1.8. Альтернативно, в данном параметре можно указать абсолютный путь к файлу `java.exe`. 

<путь к исполнителю> - это путь к файлу lib/AlgorithmExecutor-`version`.jar в распакованном дистрибутиве *Исполнителя* для Java, где `version` - версия Исполнителя (например,  `1.0.0`).

**Предупреждение:** В связи с тем, что *Агент* не может убить подпроцессы процесса Исполнителя ([PBI 1126](https://adeptik.visualstudio.com/AgentNetwork/_workitems?id=1126&_a=edit)), регистрация *Исполнителя* в *Агенте* с использованием промежуточных скриптов (bat, скрипт PowerShell и т.д.) недопустима.

## Использование Исполнителя для Java

Аргументы командной строки соответствуют спецификации *Исполнителя*. Дополнительно реализованы следующие аргументы командной строки

  * --start --debug <файл настроек запуска>
  
### debug

Дополнительный параметр команды "--start". Если данный параметр указан при запуске *Исполнителя*, то при запуске решения *Задачи* в консоль дополнительно выводится информация для отладки:

  * Стек вызовов для необработанных *Определением алгоритма* исключений.

## Принудительное обновление зависимостей

Т.к. данный проект ссылается на артефакты, которые могут находиться в разработке (SNAPSHOT), то для выполнения принудительного скачивания новых версий артефактов, которые имеют неизмененную версию, необходимо выполнить следующие действия:
 
  1. В папке проекта выполнить команду
   
          gradlew build --refresh-dependencies
          
  2. В панели инструментов "Gradle" нажать кнопку "Refresh all Gradle projects".